
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Forecasting dengan Auto Corelation &#8212; Proyek Sains Data A</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Forecasting(autoCorelation)';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="1. Setup dan Import Library" href="test.html" />
    <link rel="prev" title="Forecasting" href="Forecasting.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.jpg" class="logo__image only-light" alt="Proyek Sains Data A - Home"/>
    <script>document.write(`<img src="_static/logo.jpg" class="logo__image only-dark" alt="Proyek Sains Data A - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to my learning site : “PROYEK SAINS DATA - A”
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="memahamiBisnis.html">Bussines Understanding</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataUnderstanding.html">Data Understanding</a></li>
<li class="toctree-l1"><a class="reference internal" href="ExplorasiData.html">Exploration Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="PreprocessingData.html">Data Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="ketidakseimbanganData.html"><strong>Preprocessing Data (Menyeimbangkan Data menggunakan SMOTE)</strong></a></li>




<li class="toctree-l1"><a class="reference internal" href="ketidakseimbanganData2.html"><strong>Preprocessing Data (Menyeimbangkan Data menggunakan SMOTE) Data Bank</strong></a></li>




<li class="toctree-l1"><a class="reference internal" href="Forecasting.html">Forecasting NO2 with KNN</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Forecasting NO2 with KNN (Auto Correlation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html"><strong>1. Setup dan Import Library</strong></a></li>






<li class="toctree-l1"><a class="reference internal" href="Forecasting%28Exponential%20Smooting%29.html">Forecasting NO2 with Exponential Smoothing</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FForecasting(autoCorelation).html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Forecasting(autoCorelation).ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Forecasting dengan Auto Corelation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#apa-itu-forecasting">- Apa itu Forecasting?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mengapa-forecasting-penting">- Mengapa Forecasting penting?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#crawling-data">- Crawling Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-libarary-yang-dibutuhkan">1. Import libarary yang dibutuhkan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#definisi-kan-koordinat-di-wilayah-kamal-dan-parameter-waktu-2022-2025">2. Definisi kan koordinat di wilayah Kamal dan parameter waktu (2022-2025)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-data-sentinel-5p-no2-dan-agregasi-temporal-harian">3. Loading data Sentinel-5P NO2 dan agregasi temporal harian</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#melakukan-eksekusi-job-batch-processing-untuk-memproses-data-secara-otomatis-dan-terjadwal-kemudian-mengekspor-hasilnya-ke-dalam-format-file-netcdf">4. Melakukan eksekusi job batch processing untuk memproses data secara otomatis dan terjadwal, kemudian mengekspor hasilnya ke dalam format file NetCDF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ubah-data-netcdf-ke-csv-agar-lebih-mudah-untuk-digunakan">5. Ubah data NetCDF ke CSV agar lebih mudah untuk digunakan</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">- Preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mengurutkan-data-berdasarkan-tanggal-waktu">- Mengurutkan Data berdasarkan tanggal/waktu</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mengatasi-missing-value-dengan-interpolasi">- Mengatasi Missing Value dengan interpolasi</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deteksi-penanganan-outlier">- DETEKSI &amp; PENANGANAN OUTLIER</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mengubah-data-time-series-ke-data-supervised">- Mengubah data time series ke data supervised</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#autokorelasi-seleksi-fitur">- AUTOKORELASI &amp; SELEKSI FITUR</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#normalisasi-data-menggunakan-zscore-dengan-standart-sklearn">- Normalisasi Data menggunakan zscore dengan standart sklearn</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#knn-regression">- KNN Regression</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-library-yang-dibutuhkan">1. Import LIbrary yang dibutuhkan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#explorasi-data">2. Explorasi Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#persiapan-data-untuk-modelling">3. Persiapan Data untuk Modelling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#membagi-data-train-dan-test">4. Membagi data Train dan Test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hyperparameter-tuning-mencari-k-optimal">5. HYPERPARAMETER TUNING (Mencari K Optimal)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#training-model-knn-regression">6. Training Model KNN Regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluasi-model">7. Evaluasi Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#klasifikasi-indikator-kualitas-udara">8. Klasifikasi Indikator Kualitas Udara</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualisasi-hasil">9. Visualisasi Hasil</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="forecasting-dengan-auto-corelation">
<h1>Forecasting dengan Auto Corelation<a class="headerlink" href="#forecasting-dengan-auto-corelation" title="Link to this heading">#</a></h1>
<section id="apa-itu-forecasting">
<h2>- Apa itu Forecasting?<a class="headerlink" href="#apa-itu-forecasting" title="Link to this heading">#</a></h2>
<p>Bayangkan Anda adalah seorang kapten kapal yang mencoba menavigasi lautan yang tidak pasti di depan. Untuk tahu ke mana harus berlayar, Anda tidak bisa hanya menebak-nebak; Anda harus melihat ke belakang, mempelajari catatan perjalanan sebelumnya, menganalisis pola angin musiman, dan data arus laut yang telah dikumpulkan. Inilah inti dari forecasting (peramalan): sebuah proses sistematis untuk memprediksi apa yang akan terjadi di masa depan dengan cara menggali dan menganalisis data historis serta tren masa lalu. Baik itu untuk memperkirakan cuaca besok, penjualan produk bulan depan, atau, seperti dalam kasus Anda, memprediksi tingkat polusi <span class="math notranslate nohighlight">\(NO_2\)</span>, tujuannya selalu sama—yaitu menggunakan wawasan dari masa lalu untuk mengurangi ketidakpastian dan membantu kita mengambil keputusan yang lebih cerdas dan lebih siap hari ini.</p>
</section>
<section id="mengapa-forecasting-penting">
<h2>- Mengapa Forecasting penting?<a class="headerlink" href="#mengapa-forecasting-penting" title="Link to this heading">#</a></h2>
<p>Pada intinya, kita melihat pola-pola yang terjadi di masa lalu (seperti tren musiman, siklus, atau kebiasaan) dan menggunakan pola tersebut untuk membuat perkiraan yang logis tentang apa yang akan terjadi selanjutnya.Tujuan utamanya adalah untuk mengurangi ketidakpastian dalam pengambilan keputusan. Dengan memiliki perkiraan yang berbasis data, sebuah organisasi atau individu dapat membuat perencanaan yang lebih matang, mengantisipasi risiko, dan mengalokasikan sumber daya secara lebih efisien.</p>
</section>
<section id="crawling-data">
<h2>- Crawling Data<a class="headerlink" href="#crawling-data" title="Link to this heading">#</a></h2>
<section id="import-libarary-yang-dibutuhkan">
<h3>1. Import libarary yang dibutuhkan<a class="headerlink" href="#import-libarary-yang-dibutuhkan" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">openeo</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.neighbors</span><span class="w"> </span><span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_absolute_percentage_error</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">openeo</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;openeo.dataspace.copernicus.eu&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">authenticate_oidc</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connected to Copernicus Data Space Ecosystem&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Authenticated using refresh token.
Connected to Copernicus Data Space Ecosystem
</pre></div>
</div>
</div>
</div>
</section>
<section id="definisi-kan-koordinat-di-wilayah-kamal-dan-parameter-waktu-2022-2025">
<h3>2. Definisi kan koordinat di wilayah Kamal dan parameter waktu (2022-2025)<a class="headerlink" href="#definisi-kan-koordinat-di-wilayah-kamal-dan-parameter-waktu-2022-2025" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aoi</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span>
  <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Feature&quot;</span><span class="p">,</span>
      <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{},</span>
      <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">[</span>
            <span class="p">[</span>
              <span class="mf">112.71199080623381</span><span class="p">,</span>
              <span class="o">-</span><span class="mf">7.151070739706199</span>
            <span class="p">],</span>
            <span class="p">[</span>
              <span class="mf">112.71199080623381</span><span class="p">,</span>
              <span class="o">-</span><span class="mf">7.168985131602568</span>
            <span class="p">],</span>
            <span class="p">[</span>
              <span class="mf">112.73980259222657</span><span class="p">,</span>
              <span class="o">-</span><span class="mf">7.168985131602568</span>
            <span class="p">],</span>
            <span class="p">[</span>
              <span class="mf">112.73980259222657</span><span class="p">,</span>
              <span class="o">-</span><span class="mf">7.151070739706199</span>
            <span class="p">],</span>
            <span class="p">[</span>
              <span class="mf">112.71199080623381</span><span class="p">,</span>
              <span class="o">-</span><span class="mf">7.151070739706199</span>
            <span class="p">]</span>
          <span class="p">]</span>
        <span class="p">],</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Polygon&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Define spatial extent from AOI coordinates</span>
<span class="n">spatial_extent</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;west&quot;</span><span class="p">:</span> <span class="mf">112.71199080623381</span><span class="p">,</span>
    <span class="s2">&quot;south&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">7.168985131602568</span><span class="p">,</span>
    <span class="s2">&quot;east&quot;</span><span class="p">:</span> <span class="mf">112.73980259222657</span><span class="p">,</span>
    <span class="s2">&quot;north&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">7.151070739706199</span>
<span class="p">}</span>

<span class="n">start_date</span> <span class="o">=</span> <span class="s2">&quot;2022-10-23&quot;</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="s2">&quot;2025-10-23&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AOI defined for coordinates: </span><span class="si">{</span><span class="n">spatial_extent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time range: </span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setup completed successfully&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AOI defined for coordinates: {&#39;west&#39;: 112.71199080623381, &#39;south&#39;: -7.168985131602568, &#39;east&#39;: 112.73980259222657, &#39;north&#39;: -7.151070739706199}
Time range: 2022-10-23 to 2025-10-23
Setup completed successfully
</pre></div>
</div>
</div>
</div>
</section>
<section id="loading-data-sentinel-5p-no2-dan-agregasi-temporal-harian">
<h3>3. Loading data Sentinel-5P NO2 dan agregasi temporal harian<a class="headerlink" href="#loading-data-sentinel-5p-no2-dan-agregasi-temporal-harian" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading Sentinel-5P NO2 data...&quot;</span><span class="p">)</span>

<span class="n">s5p_no2</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">load_collection</span><span class="p">(</span>
    <span class="s2">&quot;SENTINEL_5P_L2&quot;</span><span class="p">,</span>
    <span class="n">temporal_extent</span><span class="o">=</span><span class="p">[</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">],</span>
    <span class="n">spatial_extent</span><span class="o">=</span><span class="n">spatial_extent</span><span class="p">,</span>
    <span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;NO2&quot;</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">s5p_monthly</span> <span class="o">=</span> <span class="n">s5p_no2</span><span class="o">.</span><span class="n">aggregate_temporal_period</span><span class="p">(</span>
    <span class="n">period</span><span class="o">=</span><span class="s2">&quot;day&quot;</span><span class="p">,</span>
    <span class="n">reducer</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data collection and aggregation configured successfully&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading Sentinel-5P NO2 data...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data collection and aggregation configured successfully
</pre></div>
</div>
</div>
</div>
</section>
<section id="melakukan-eksekusi-job-batch-processing-untuk-memproses-data-secara-otomatis-dan-terjadwal-kemudian-mengekspor-hasilnya-ke-dalam-format-file-netcdf">
<h3>4. Melakukan eksekusi job batch processing untuk memproses data secara otomatis dan terjadwal, kemudian mengekspor hasilnya ke dalam format file NetCDF<a class="headerlink" href="#melakukan-eksekusi-job-batch-processing-untuk-memproses-data-secara-otomatis-dan-terjadwal-kemudian-mengekspor-hasilnya-ke-dalam-format-file-netcdf" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting data processing job...&quot;</span><span class="p">)</span>

<span class="n">job</span> <span class="o">=</span> <span class="n">s5p_monthly</span><span class="o">.</span><span class="n">execute_batch</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;NO2 Averages 2021-2025&quot;</span><span class="p">,</span> 
    <span class="n">outputfile</span><span class="o">=</span><span class="s2">&quot;no2_averages_4years.nc&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting data processing job...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0:00:00 Job &#39;j-2511211408464bab98e306975b0a3509&#39;: send &#39;start&#39;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0:00:14 Job &#39;j-2511211408464bab98e306975b0a3509&#39;: created (progress 0%)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0:00:19 Job &#39;j-2511211408464bab98e306975b0a3509&#39;: created (progress 0%)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0:00:26 Job &#39;j-2511211408464bab98e306975b0a3509&#39;: running (progress N/A)
</pre></div>
</div>
</div>
</div>
</section>
<section id="ubah-data-netcdf-ke-csv-agar-lebih-mudah-untuk-digunakan">
<h3>5. Ubah data NetCDF ke CSV agar lebih mudah untuk digunakan<a class="headerlink" href="#ubah-data-netcdf-ke-csv-agar-lebih-mudah-untuk-digunakan" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Buka file .nc Anda</span>
<span class="c1"># Ganti &#39;openEO.nc&#39; jika nama filenya berbeda</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Dokumen</span><span class="se">\\</span><span class="s2">PSD</span><span class="se">\\</span><span class="s2">dataset</span><span class="se">\\</span><span class="s2">openEO.nc&quot;</span><span class="p">)</span>

<span class="c1"># 2. Konversi dataset xarray menjadi DataFrame pandas</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>

<span class="c1"># 3. [PENTING] Ratakan Multi-Index</span>
<span class="c1"># Data NetCDF biasanya punya banyak index (spt waktu, lat, lon).</span>
<span class="c1"># &#39;reset_index()&#39; akan mengubah semua index itu menjadi kolom biasa.</span>
<span class="n">df_flat</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># 4. Simpan sebagai file CSV</span>
<span class="n">df_flat</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;hasil_data_no2.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selesai! File &#39;hasil_data_no2.csv&#39; telah dibuat.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Selesai! File &#39;hasil_data_no2.csv&#39; telah dibuat.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="preprocessing">
<h2>- Preprocessing<a class="headerlink" href="#preprocessing" title="Link to this heading">#</a></h2>
<section id="mengurutkan-data-berdasarkan-tanggal-waktu">
<h3>- Mengurutkan Data berdasarkan tanggal/waktu<a class="headerlink" href="#mengurutkan-data-berdasarkan-tanggal-waktu" title="Link to this heading">#</a></h3>
<p>Mengurutkan data berdasarkan tanggal/waktu (sortir kronologis) adalah langkah preprocessing yang fundamental, terutama untuk data time-series (data berurutan).</p>
<p>Ini penting karena mengubah data yang acak menjadi sebuah alur cerita yang logis.</p>
<p>Tujuannya adalah untuk memastikan bahwa setiap observasi (baris data) ditempatkan dalam urutan yang benar sesuai kejadiannya. Tanpa pengurutan ini, analisis seperti mencari tren, mengidentifikasi pola musiman, atau melakukan interpolasi (mengisi data hilang) akan menghasilkan kesimpulan yang salah, karena hubungan antar-waktu antar-titik data menjadi rusak.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Baca file CSV</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;hasil_data_no2.csv&#39;</span><span class="p">)</span>

<span class="c1"># 2. Ubah kolom &#39;t&#39; menjadi format datetime</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>

<span class="c1"># 3. Urutkan DataFrame berdasarkan kolom &#39;t&#39;</span>
<span class="n">df_sorted</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>

<span class="c1"># 4. Menampilkan hasil pengirutan</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_sorted</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selesai! Data telah diurutkan berdasarkan waktu dan disimpan di &#39;hasil_data_no2_sorted.csv&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              t           x         y  crs       NO2
0    2022-10-23  112.739273 -7.151624  b&#39;&#39;  0.000030
1    2022-10-24  112.739273 -7.151624  b&#39;&#39;       NaN
2    2022-10-25  112.739273 -7.151624  b&#39;&#39;  0.000070
3    2022-10-26  112.739273 -7.151624  b&#39;&#39;       NaN
4    2022-10-27  112.739273 -7.151624  b&#39;&#39;       NaN
...         ...         ...       ...  ...       ...
1085 2025-10-18  112.739273 -7.151624  b&#39;&#39;  0.000015
1086 2025-10-19  112.739273 -7.151624  b&#39;&#39;  0.000056
1087 2025-10-20  112.739273 -7.151624  b&#39;&#39;       NaN
1088 2025-10-21  112.739273 -7.151624  b&#39;&#39;       NaN
1089 2025-10-22  112.739273 -7.151624  b&#39;&#39;       NaN

[1090 rows x 5 columns]
Selesai! Data telah diurutkan berdasarkan waktu dan disimpan di &#39;hasil_data_no2_sorted.csv&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="mengatasi-missing-value-dengan-interpolasi">
<h3>- Mengatasi Missing Value dengan interpolasi<a class="headerlink" href="#mengatasi-missing-value-dengan-interpolasi" title="Link to this heading">#</a></h3>
<p>Mengatasi <em>missing value</em> (data hilang) dengan <strong>interpolasi</strong> adalah teknik <em>preprocessing</em> untuk “menebak” nilai yang hilang secara cerdas.</p>
<p>Cara kerjanya adalah dengan <strong>melihat nilai-nilai tetangga yang diketahui</strong> (misalnya, nilai sebelum dan sesudah data yang hilang) dan menarik garis lurus (atau kurva) di antara keduanya. Nilai yang hilang kemudian diisi dengan titik yang jatuh tepat di atas garis tersebut.</p>
<p>Ini adalah metode yang sangat umum untuk data <em>time-series</em> (seperti data cuaca atau polusi) karena metode ini <strong>mempertahankan kelancaran dan tren data</strong> dari waktu ke waktu, alih-alih hanya mengisi dengan nilai rata-rata atau membuang baris data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>
<span class="n">df_sorted</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="n">df_indexed</span> <span class="o">=</span> <span class="n">df_sorted</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="n">df_indexed</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_indexed</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">df_interpolated</span> <span class="o">=</span> <span class="n">df_indexed</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data diinterpolasi. Jumlah baris: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_interpolated</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data diinterpolasi. Jumlah baris: 1090
</pre></div>
</div>
</div>
</div>
</section>
<section id="deteksi-penanganan-outlier">
<h3>- DETEKSI &amp; PENANGANAN OUTLIER<a class="headerlink" href="#deteksi-penanganan-outlier" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p01</span> <span class="o">=</span> <span class="n">df_interpolated</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">p99</span> <span class="o">=</span> <span class="n">df_interpolated</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.99</span><span class="p">)</span>
<span class="c1"># Hitung jumlah outlier yang ditemukan</span>
<span class="n">outliers_low</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_interpolated</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">p01</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">outliers_high</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_interpolated</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">p99</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deteksi outlier: </span><span class="si">{</span><span class="n">outliers_low</span><span class="si">}</span><span class="s2"> nilai rendah dan </span><span class="si">{</span><span class="n">outliers_high</span><span class="si">}</span><span class="s2"> nilai tinggi ditemukan.&quot;</span><span class="p">)</span>
<span class="c1"># Ganti outlier dengan nilai persentil (clipping)</span>
<span class="n">df_interpolated</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_interpolated</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="n">p01</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">p99</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Outlier telah diganti (clipping).&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Deteksi outlier: 11 nilai rendah dan 11 nilai tinggi ditemukan.
Outlier telah diganti (clipping).
</pre></div>
</div>
</div>
</div>
</section>
<section id="mengubah-data-time-series-ke-data-supervised">
<h3>- Mengubah data time series ke data supervised<a class="headerlink" href="#mengubah-data-time-series-ke-data-supervised" title="Link to this heading">#</a></h3>
<p>Mengubah data time-series menjadi supervised adalah proses preprocessing untuk menggeser data (lagging) agar bisa digunakan untuk machine learning.Pada dasarnya, Anda mengubah satu kolom data (misalnya, <span class="math notranslate nohighlight">\(NO_2\)</span>) menjadi format “input-output”.Anda mengambil nilai-nilai dari hari-hari sebelumnya (misalnya, <span class="math notranslate nohighlight">\(t-1\)</span>, <span class="math notranslate nohighlight">\(t-2\)</span>, <span class="math notranslate nohighlight">\(t-3\)</span>) sebagai fitur (X), dan menggunakan nilai hari ini (<span class="math notranslate nohighlight">\(t\)</span>) sebagai target (y) yang ingin diprediksi.Proses ini mengubah data dari:[Nilai hari ini]Menjadi:[Nilai kemarin, Nilai 2 hari lalu, Nilai 3 hari lalu] -&gt; [Nilai hari ini]</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N_LAGS</span> <span class="o">=</span> <span class="mi">30</span> 
<span class="n">data</span> <span class="o">=</span> <span class="n">df_interpolated</span><span class="p">[[</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;NO2&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N_LAGS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;NO2(t-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;NO2&#39;</span><span class="p">:</span> <span class="s1">&#39;NO2_target(t)&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_supervised_full</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Simpan full supervised data</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data supervised dibuat dengan </span><span class="si">{</span><span class="n">N_LAGS</span><span class="si">}</span><span class="s2"> lags.&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df_supervised_full</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data supervised dibuat dengan 30 lags.
           t  NO2_target(t)  NO2(t-1)  NO2(t-2)  NO2(t-3)  NO2(t-4)  NO2(t-5)  \
0 2022-11-22       0.000059  0.000054  0.000050  0.000045  0.000040  0.000035   
1 2022-11-23       0.000059  0.000059  0.000054  0.000050  0.000045  0.000040   
2 2022-11-24       0.000059  0.000059  0.000059  0.000054  0.000050  0.000045   
3 2022-11-25       0.000059  0.000059  0.000059  0.000059  0.000054  0.000050   
4 2022-11-26       0.000059  0.000059  0.000059  0.000059  0.000059  0.000054   

   NO2(t-6)  NO2(t-7)  NO2(t-8)  ...  NO2(t-21)  NO2(t-22)  NO2(t-23)  \
0  0.000035  0.000034  0.000033  ...   0.000174   0.000174   0.000077   
1  0.000035  0.000035  0.000034  ...   0.000170   0.000174   0.000174   
2  0.000040  0.000035  0.000035  ...   0.000146   0.000170   0.000174   
3  0.000045  0.000040  0.000035  ...   0.000122   0.000146   0.000170   
4  0.000050  0.000045  0.000040  ...   0.000099   0.000122   0.000146   

   NO2(t-24)  NO2(t-25)  NO2(t-26)  NO2(t-27)  NO2(t-28)  NO2(t-29)  NO2(t-30)  
0   0.000174   0.000032   0.000045   0.000057   0.000070   0.000050   0.000030  
1   0.000077   0.000174   0.000032   0.000045   0.000057   0.000070   0.000050  
2   0.000174   0.000077   0.000174   0.000032   0.000045   0.000057   0.000070  
3   0.000174   0.000174   0.000077   0.000174   0.000032   0.000045   0.000057  
4   0.000170   0.000174   0.000174   0.000077   0.000174   0.000032   0.000045  

[5 rows x 32 columns]
</pre></div>
</div>
</div>
</div>
</section>
<section id="autokorelasi-seleksi-fitur">
<h3>- AUTOKORELASI &amp; SELEKSI FITUR<a class="headerlink" href="#autokorelasi-seleksi-fitur" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Memulai Autokorelasi untuk Seleksi Fitur...&quot;</span><span class="p">)</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_supervised_full</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">corr_target</span> <span class="o">=</span> <span class="n">corr_matrix</span><span class="p">[</span><span class="s1">&#39;NO2_target(t)&#39;</span><span class="p">]</span>
<span class="n">feature_cols</span> <span class="o">=</span> <span class="n">corr_target</span><span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">corr_target</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">corr_target</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;NO2(t-&#39;</span><span class="p">))]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fitur lag terpilih (korelasi &gt; 0.5): </span><span class="si">{</span><span class="n">feature_cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">feature_cols</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PERINGATAN: Tidak ada fitur lag &gt; 0.5. Menggunakan lag t-1 sebagai default.&quot;</span><span class="p">)</span>
    <span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NO2(t-1)&#39;</span><span class="p">]</span> <span class="c1"># Fallback</span>

<span class="n">target_col</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NO2_target(t)&#39;</span><span class="p">]</span>
<span class="n">all_selected_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">feature_cols</span> <span class="o">+</span> <span class="n">target_col</span>
<span class="n">df_supervised</span> <span class="o">=</span> <span class="n">df_supervised_full</span><span class="p">[</span><span class="n">all_selected_cols</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> 
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Kolom yang tidak terpilih telah di-drop.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Memulai Autokorelasi untuk Seleksi Fitur...
Fitur lag terpilih (korelasi &gt; 0.5): [&#39;NO2(t-1)&#39;, &#39;NO2(t-2)&#39;]
Kolom yang tidak terpilih telah di-drop.
</pre></div>
</div>
</div>
</div>
</section>
<section id="normalisasi-data-menggunakan-zscore-dengan-standart-sklearn">
<h3>- Normalisasi Data menggunakan zscore dengan standart sklearn<a class="headerlink" href="#normalisasi-data-menggunakan-zscore-dengan-standart-sklearn" title="Link to this heading">#</a></h3>
<p>Menggunakan StandardScaler (metode Z-score) dari sklearn adalah teknik preprocessing untuk menstandardisasi fitur data Anda.Tujuannya adalah untuk mengubah skala setiap fitur sehingga memiliki:</p>
<ol class="arabic simple">
<li><p>Rata-rata (mean)</p></li>
<li><p>Standar deviasi (standard deviation)</p></li>
</ol>
<p>Proses ini menghitung seberapa jauh setiap titik data dari rata-rata, diukur dalam satuan standar deviasi. Ini sangat penting untuk algoritma berbasis jarak (seperti kNN yang Anda gunakan) karena memastikan bahwa semua fitur memberikan kontribusi yang setara pada perhitungan jarak, terlepas dari apakah skala aslinya sangat besar (misal: ribuan) atau sangat kecil (misal: <span class="math notranslate nohighlight">\(0.001\)</span>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Melakukan normalisasi Z-Score...&quot;</span><span class="p">)</span>
<span class="n">feature_scaler_z</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">target_scaler_z</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">df_scaled</span> <span class="o">=</span> <span class="n">df_supervised</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> 
<span class="n">df_scaled</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_scaler_z</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_scaled</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">])</span>
<span class="n">df_scaled</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_scaler_z</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_scaled</span><span class="p">[</span><span class="n">target_col</span><span class="p">])</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_scaled</span><span class="p">[</span><span class="n">feature_cols</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_scaled</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df_scaled</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Melakukan normalisasi Z-Score...
           t  NO2(t-1)  NO2(t-2)  NO2_target(t)
0 2022-11-22  0.553580  0.376330       0.731018
1 2022-11-23  0.731077  0.553845       0.725616
2 2022-11-24  0.725675  0.731361       0.720214
3 2022-11-25  0.720273  0.725958       0.714812
4 2022-11-26  0.714871  0.720555       0.709410
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="knn-regression">
<h2>- KNN Regression<a class="headerlink" href="#knn-regression" title="Link to this heading">#</a></h2>
<p>kNN Regression (K-Nearest Neighbors Regression) adalah algoritma supervised learning yang memprediksi sebuah nilai numerik (kontinu) berdasarkan ‘tetangga’ terdekatnya.</p>
<p>Prinsipnya sederhana: Untuk menebak nilai dari sebuah data baru, model ini akan mencari ‘K’ buah data dari training set yang fitur-fiturnya (X) paling mirip (paling dekat jaraknya).</p>
<p>Setelah ‘K’ tetangga terdekat ditemukan, model akan mengambil nilai target (y) dari semua tetangga tersebut dan menghitung nilai rata-ratanya. Hasil rata-rata inilah yang menjadi nilai prediksi untuk data baru tersebut.</p>
<section id="import-library-yang-dibutuhkan">
<h3>1. Import LIbrary yang dibutuhkan<a class="headerlink" href="#import-library-yang-dibutuhkan" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.neighbors</span><span class="w"> </span><span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_absolute_percentage_error</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">joblib</span> 
</pre></div>
</div>
</div>
</div>
</section>
<section id="explorasi-data">
<h3>2. Explorasi Data<a class="headerlink" href="#explorasi-data" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Menggunakan DataFrame &#39;df_scaled_z&#39; yang sudah dinormalisasi (Z-Score)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- 1. Informasi Tipe Data &amp; Non-Null ---&quot;</span><span class="p">)</span>
<span class="c1"># .info() akan mencetak ringkasan DataFrame</span>
<span class="n">df_scaled</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- 2. Deskripsi Statistik ---&quot;</span><span class="p">)</span>
<span class="c1"># .describe() akan memberikan statistik deskriptif</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_scaled</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- 3. Pengecekan Missing Values ---&quot;</span><span class="p">)</span>
<span class="c1"># .isna().sum() akan menghitung jumlah nilai NaN di setiap kolom</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_scaled</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- 1. Informasi Tipe Data &amp; Non-Null ---
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1060 entries, 0 to 1059
Data columns (total 4 columns):
 #   Column         Non-Null Count  Dtype         
---  ------         --------------  -----         
 0   t              1060 non-null   datetime64[ns]
 1   NO2(t-1)       1060 non-null   float64       
 2   NO2(t-2)       1060 non-null   float64       
 3   NO2_target(t)  1060 non-null   float64       
dtypes: datetime64[ns](1), float64(3)
memory usage: 33.3 KB

--- 2. Deskripsi Statistik ---
                                   t      NO2(t-1)      NO2(t-2)  \
count                           1060  1.060000e+03  1.060000e+03   
mean   2024-05-07 05:38:15.849056768 -2.547229e-16 -1.340647e-16   
min              2022-11-22 00:00:00 -1.377850e+00 -1.377781e+00   
25%              2023-08-13 18:00:00 -6.399274e-01 -6.397836e-01   
50%              2024-05-07 12:00:00 -1.941542e-01 -1.939650e-01   
75%              2025-01-28 06:00:00  4.477700e-01  4.464952e-01   
max              2025-10-22 00:00:00  5.032137e+00  5.032858e+00   
std                              NaN  1.000472e+00  1.000472e+00   

       NO2_target(t)  
count   1.060000e+03  
mean   -2.681293e-17  
min    -1.377859e+00  
25%    -6.399537e-01  
50%    -1.941911e-01  
75%     4.477178e-01  
max     5.031975e+00  
std     1.000472e+00  

--- 3. Pengecekan Missing Values ---
t                0
NO2(t-1)         0
NO2(t-2)         0
NO2_target(t)    0
dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section id="persiapan-data-untuk-modelling">
<h3>3. Persiapan Data untuk Modelling<a class="headerlink" href="#persiapan-data-untuk-modelling" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Kita menggunakan DataFrame &#39;df_scaled_z&#39; (hasil Z-Score)</span>

<span class="c1"># 1. Identifikasi Kolom Fitur (X)</span>
<span class="c1"># Ini adalah variabel prediktor (data historis)</span>
<span class="n">feature_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_scaled</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;NO2(t-&#39;</span><span class="p">)]</span>

<span class="c1"># 2. Identifikasi Kolom Target (y)</span>
<span class="c1"># Ini adalah variabel yang ingin diprediksi (data saat ini)</span>
<span class="n">target_column</span> <span class="o">=</span> <span class="s1">&#39;NO2_target(t)&#39;</span>

<span class="c1"># 3. Buat variabel X dan y</span>
<span class="c1"># X (biasanya huruf besar) adalah DataFrame yang berisi semua fitur</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_scaled</span><span class="p">[</span><span class="n">feature_columns</span><span class="p">]</span>

<span class="c1"># y (biasanya huruf kecil) adalah Series yang berisi target</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_scaled</span><span class="p">[</span><span class="n">target_column</span><span class="p">]</span>

<span class="c1"># 4. Tampilkan konfirmasi</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- Variabel Fitur (X) ---&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Kolom yang digunakan: </span><span class="si">{</span><span class="n">feature_columns</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Variabel Target (y) ---&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Kolom yang digunakan: </span><span class="si">{</span><span class="n">target_column</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Variabel Fitur (X) ---
Kolom yang digunakan: [&#39;NO2(t-1)&#39;, &#39;NO2(t-2)&#39;]
   NO2(t-1)  NO2(t-2)
0  0.553580  0.376330
1  0.731077  0.553845
2  0.725675  0.731361
3  0.720273  0.725958
4  0.714871  0.720555

--- Variabel Target (y) ---
Kolom yang digunakan: NO2_target(t)
0    0.731018
1    0.725616
2    0.720214
3    0.714812
4    0.709410
Name: NO2_target(t), dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="membagi-data-train-dan-test">
<h3>4. Membagi data Train dan Test<a class="headerlink" href="#membagi-data-train-dan-test" title="Link to this heading">#</a></h3>
<p>membagi data menjadi set Latih dan Uji. Karena ini data waktu, Anda membaginya secara berurutan (80% data awal untuk latih, 20% data akhir untuk uji), bukan secara acak.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)]</span>
<span class="n">t_test</span> <span class="o">=</span> <span class="n">df_supervised</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">df_supervised</span><span class="p">)]</span>
<span class="n">train_data_orig</span> <span class="o">=</span> <span class="n">df_interpolated</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">y_test_orig</span> <span class="o">=</span> <span class="n">target_scaler_z</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data siap: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span><span class="si">}</span><span class="s2"> train, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="si">}</span><span class="s2"> test.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data siap: 848 train, 212 test.
</pre></div>
</div>
</div>
</div>
</section>
<section id="hyperparameter-tuning-mencari-k-optimal">
<h3>5. HYPERPARAMETER TUNING (Mencari K Optimal)<a class="headerlink" href="#hyperparameter-tuning-mencari-k-optimal" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Memulai pencarian K optimal...&quot;</span><span class="p">)</span>
<span class="n">rmse_values</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">range_k</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">range_k</span><span class="p">:</span>
    <span class="n">knn_model_tune</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">knn_model_tune</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred_tune</span> <span class="o">=</span> <span class="n">knn_model_tune</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">y_pred_orig_tune</span> <span class="o">=</span> <span class="n">target_scaler_z</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_pred_tune</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test_orig</span><span class="p">,</span> <span class="n">y_pred_orig_tune</span><span class="p">))</span>
    <span class="n">rmse_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmse</span><span class="p">)</span>
<span class="n">best_rmse_from_tuning</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">rmse_values</span><span class="p">)</span>
<span class="n">best_k</span> <span class="o">=</span> <span class="n">rmse_values</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">best_rmse_from_tuning</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pencarian K selesai. K optimal ditemukan: </span><span class="si">{</span><span class="n">best_k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Memulai pencarian K optimal...
Pencarian K selesai. K optimal ditemukan: 30
</pre></div>
</div>
</div>
</div>
</section>
<section id="training-model-knn-regression">
<h3>6. Training Model KNN Regression<a class="headerlink" href="#training-model-knn-regression" title="Link to this heading">#</a></h3>
<p>Training Model Default. Anda menginisialisasi model KNeighborsRegressor dengan <span class="math notranslate nohighlight">\(k=5\)</span> dan melatihnya (.fit()) menggunakan X_train dan y_train.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Melatih model final dengan K = </span><span class="si">{</span><span class="n">best_k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">final_knn_model</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">best_k</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">final_knn_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Melatih model final dengan K = 30
</pre></div>
</div>
<div class="output text_html"><style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>KNeighborsRegressor(n_jobs=-1, n_neighbors=30)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;KNeighborsRegressor<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.neighbors.KNeighborsRegressor.html">?<span>Documentation for KNeighborsRegressor</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>KNeighborsRegressor(n_jobs=-1, n_neighbors=30)</pre></div> </div></div></div></div></div></div>
</div>
</section>
<section id="evaluasi-model">
<h3>7. Evaluasi Model<a class="headerlink" href="#evaluasi-model" title="Link to this heading">#</a></h3>
<p>menggunakan model yang baru dilatih (knn_model) untuk membuat prediksi pada data yang belum pernah dilihatnya (X_test). Hasilnya disimpan di y_pred</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Mengevaluasi model final...&quot;</span><span class="p">)</span>
<span class="n">y_pred_final</span> <span class="o">=</span> <span class="n">final_knn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="c1"># Denormalisasi hasil</span>
<span class="n">y_pred_orig_final</span> <span class="o">=</span> <span class="n">target_scaler_z</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_pred_final</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Hitung metrik</span>
<span class="n">final_mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test_orig</span><span class="p">,</span> <span class="n">y_pred_orig_final</span><span class="p">)</span>
<span class="n">final_mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test_orig</span><span class="p">,</span> <span class="n">y_pred_orig_final</span><span class="p">)</span>
<span class="n">final_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">final_mse</span><span class="p">)</span>
<span class="n">final_mape</span> <span class="o">=</span> <span class="n">mean_absolute_percentage_error</span><span class="p">(</span><span class="n">y_test_orig</span><span class="p">,</span> <span class="n">y_pred_orig_final</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="c1"># MAPE</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Evaluasi Model Final (K=</span><span class="si">{</span><span class="n">best_k</span><span class="si">}</span><span class="s2">) ---&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE:  </span><span class="si">{</span><span class="n">final_mae</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MSE:  </span><span class="si">{</span><span class="n">final_mse</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE: </span><span class="si">{</span><span class="n">final_rmse</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAPE: </span><span class="si">{</span><span class="n">final_mape</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">final_mape</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Kualitas Model: Baik Sekali (MAPE &lt; 10%)&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">final_mape</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Kualitas Model: Baik (MAPE 10-20%)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Kualitas Model: Cukup (MAPE &gt; 20%)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mengevaluasi model final...
--- Evaluasi Model Final (K=30) ---
MAE:  0.000012
MSE:  0.000000
RMSE: 0.000020
MAPE: 72.52%
</pre></div>
</div>
</div>
</div>
</section>
<section id="klasifikasi-indikator-kualitas-udara">
<h3>8. Klasifikasi Indikator Kualitas Udara<a class="headerlink" href="#klasifikasi-indikator-kualitas-udara" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Membuat klasifikasi 4-kategori (berbasis kuartil data latih)...&quot;</span><span class="p">)</span>

<span class="c1"># Hitung threshold kuartil HANYA dari data latih</span>
<span class="n">q1</span> <span class="o">=</span> <span class="n">train_data_orig</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">q2_median</span> <span class="o">=</span> <span class="n">train_data_orig</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.50</span><span class="p">)</span>
<span class="n">q3</span> <span class="o">=</span> <span class="n">train_data_orig</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Thresholds (dari data latih): Q1 (Sangat Rendah) &lt;= </span><span class="si">{</span><span class="n">q1</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">, Q2 (Rendah) &lt;= </span><span class="si">{</span><span class="n">q2_median</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">, Q3 (Sedang) &lt;= </span><span class="si">{</span><span class="n">q3</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Fungsi klasifikasi baru</span>
<span class="k">def</span><span class="w"> </span><span class="nf">classify_air_quality</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">q1</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Sangat Rendah&quot;</span>
    <span class="k">elif</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">q2</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Rendah&quot;</span>
    <span class="k">elif</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">q3</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Sedang&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Tinggi&quot;</span>

<span class="c1"># Buat DataFrame hasil (sudah denormalisasi)</span>
<span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Tanggal&#39;</span><span class="p">:</span> <span class="n">t_test</span><span class="p">,</span>
    <span class="s1">&#39;Aktual&#39;</span><span class="p">:</span> <span class="n">y_test_orig</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
    <span class="s1">&#39;Prediksi&#39;</span><span class="p">:</span> <span class="n">y_pred_orig_final</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="p">})</span>

<span class="c1"># Terapkan klasifikasi</span>
<span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Kualitas Udara Aktual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Aktual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">classify_air_quality</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2_median</span><span class="p">,</span> <span class="n">q3</span><span class="p">))</span>
<span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Kualitas Udara Prediksi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Prediksi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">classify_air_quality</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2_median</span><span class="p">,</span> <span class="n">q3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cuplikan 5 baris pertama hasil klasifikasi:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_results</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">df_results</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;hasil_prediksi_dan_klasifikasi.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hasil lengkap disimpan di &#39;hasil_prediksi_dan_klasifikasi.csv&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Membuat klasifikasi 4-kategori (berbasis kuartil data latih)...
Thresholds (dari data latih): Q1 (Sangat Rendah) &lt;= 0.000024, Q2 (Rendah) &lt;= 0.000035, Q3 (Sedang) &lt;= 0.000054
Cuplikan 5 baris pertama hasil klasifikasi:
       Tanggal    Aktual  Prediksi Kualitas Udara Aktual  \
848 2025-03-25  0.000060  0.000059                Tinggi   
849 2025-03-26  0.000060  0.000060                Tinggi   
850 2025-03-27  0.000053  0.000060                Sedang   
851 2025-03-28  0.000048  0.000058                Sedang   
852 2025-03-29  0.000042  0.000048                Sedang   

    Kualitas Udara Prediksi  
848                  Tinggi  
849                  Tinggi  
850                  Tinggi  
851                  Tinggi  
852                  Sedang  
Hasil lengkap disimpan di &#39;hasil_prediksi_dan_klasifikasi.csv&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualisasi-hasil">
<h3>9. Visualisasi Hasil<a class="headerlink" href="#visualisasi-hasil" title="Link to this heading">#</a></h3>
<p>memvisualisasikan hasil (k=5). Anda memplot data aktual (biru) dan data prediksi (oranye) dalam satu grafik untuk melihat seberapa baik model mengikuti data aslinya.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Membuat visualisasi perbandingan model optimal...&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Tanggal&#39;</span><span class="p">],</span> <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Aktual&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data Aktual (Asli)&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Tanggal&#39;</span><span class="p">],</span> <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Prediksi&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Data Prediksi (K=</span><span class="si">{</span><span class="n">best_k</span><span class="si">}</span><span class="s1"> Optimal)&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Perbandingan Data Aktual vs Prediksi Model Optimal (K=</span><span class="si">{</span><span class="n">best_k</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Tanggal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Konsentrasi NO2 (Unit Asli)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Membuat visualisasi perbandingan model optimal...
</pre></div>
</div>
<img alt="_images/b2d1f1b3858aa8532115fec649157e381c7c791f8f4b8bef64f0c7c4a349299c.png" src="_images/b2d1f1b3858aa8532115fec649157e381c7c791f8f4b8bef64f0c7c4a349299c.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Forecasting.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Forecasting</p>
      </div>
    </a>
    <a class="right-next"
       href="test.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><strong>1. Setup dan Import Library</strong></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#apa-itu-forecasting">- Apa itu Forecasting?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mengapa-forecasting-penting">- Mengapa Forecasting penting?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#crawling-data">- Crawling Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-libarary-yang-dibutuhkan">1. Import libarary yang dibutuhkan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#definisi-kan-koordinat-di-wilayah-kamal-dan-parameter-waktu-2022-2025">2. Definisi kan koordinat di wilayah Kamal dan parameter waktu (2022-2025)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-data-sentinel-5p-no2-dan-agregasi-temporal-harian">3. Loading data Sentinel-5P NO2 dan agregasi temporal harian</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#melakukan-eksekusi-job-batch-processing-untuk-memproses-data-secara-otomatis-dan-terjadwal-kemudian-mengekspor-hasilnya-ke-dalam-format-file-netcdf">4. Melakukan eksekusi job batch processing untuk memproses data secara otomatis dan terjadwal, kemudian mengekspor hasilnya ke dalam format file NetCDF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ubah-data-netcdf-ke-csv-agar-lebih-mudah-untuk-digunakan">5. Ubah data NetCDF ke CSV agar lebih mudah untuk digunakan</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">- Preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mengurutkan-data-berdasarkan-tanggal-waktu">- Mengurutkan Data berdasarkan tanggal/waktu</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mengatasi-missing-value-dengan-interpolasi">- Mengatasi Missing Value dengan interpolasi</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deteksi-penanganan-outlier">- DETEKSI &amp; PENANGANAN OUTLIER</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mengubah-data-time-series-ke-data-supervised">- Mengubah data time series ke data supervised</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#autokorelasi-seleksi-fitur">- AUTOKORELASI &amp; SELEKSI FITUR</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#normalisasi-data-menggunakan-zscore-dengan-standart-sklearn">- Normalisasi Data menggunakan zscore dengan standart sklearn</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#knn-regression">- KNN Regression</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-library-yang-dibutuhkan">1. Import LIbrary yang dibutuhkan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#explorasi-data">2. Explorasi Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#persiapan-data-untuk-modelling">3. Persiapan Data untuk Modelling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#membagi-data-train-dan-test">4. Membagi data Train dan Test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hyperparameter-tuning-mencari-k-optimal">5. HYPERPARAMETER TUNING (Mencari K Optimal)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#training-model-knn-regression">6. Training Model KNN Regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluasi-model">7. Evaluasi Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#klasifikasi-indikator-kualitas-udara">8. Klasifikasi Indikator Kualitas Udara</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualisasi-hasil">9. Visualisasi Hasil</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Abdiadha Syabirin
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>